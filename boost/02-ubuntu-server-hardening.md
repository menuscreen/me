# Ubuntu Server Hardening

This repository contains scripts and guidelines for hardening an Ubuntu Server. Hardening refers to the process of securing a system by reducing its surface of vulnerability. Improve the overall security of Ubuntu Server and reduce the risk of successful cyber attacks using various aspects of server security such as:

* [User account management](#user-account-managment)
* [Network security](#network-security)
* [Firewall configuration](#firewall-configuration)
* [System updates and patches](#system-updates-and-patches)
* [File system permissions](#file-system-permissions)
* [Logging and monitoring](#logging-and-monitoring)

## User Account Managment

**Audit:**  
Verify that the Ubuntu operating system expires temporary user accounts within 72 hours or less.

```bash
sudo chage -l <system_account_name> | grep expires
```

**Fix:**
```bash
sudo chage -E $(date -d "+3 days" +%F) system_account_name
```

**Audit:**  
Verify the Ubuntu operating system has the "vlock" package installed by running the following command:

```bash
dpkg -l | grep vlock
```

**Fix:**
```bash
sudo apt-get install vlock
```

**Audit:**  
Verify the Ubuntu operating system enforces a 24 hours/1 day minimum password lifetime for new user accounts by running the following command:

```bash
grep -i ^pass_min_days /etc/login.defs
```

**Fix:**
```bash
# Add or modify the following line in the "/etc/login.defs" file:
PASS_MIN_DAYS 1
```

**Audit:**  
Verify the Ubuntu operating system enforces a 60-day maximum password lifetime for new user accounts by running the following command:

```bash
grep -i ^pass_max_days /etc/login.defs
```

**Fix:**
```bash
# Add or modify the following line in the "/etc/login.defs" file:
PASS_MAX_DAYS 60
```

**Audit:**  
Run the following command to verify the encrypted password is set:

```bash
sudo grep -i password /boot/grub/grub.cfg
# root password entry should begin with "password_pbkdf2"
```

**Fix:**
```bash
# Generate an encrypted (grub) password for root with the following command:
grub-mkpasswd-pbkdf2

# Using the hash from the output, modify the "/etc/grub.d/40_custom" file with the following command to add a boot password:
sudo sed -i '$i set superusers=\"root\"\npassword_pbkdf2 root <hash>' /etc/grub.d/40_custom
# where <hash> is the hash generated by grub-mkpasswd-pbkdf2 command

# Generate an updated "grub.conf" file with the new password by using the following command:
sudo update-grub
```

**Audit:**  
Verify the Ubuntu operating system contains no duplicate User IDs (UIDs) for interactive users with the following command:

```bash
awk -F ":" 'list[$3]++{print $1, $3}' /etc/passwd
```

**Fix:**  
> Edit the file "/etc/passwd" and provide each interactive user account that has a duplicate UID with a unique UID.

**Audit:**  
Verify the sudo group has only members who should have access to security functions.

```bash
grep sudo /etc/group
```

**Fix:**  
```bash
# To remove a user from the sudo group, run:
sudo gpasswd -d <username> sudo
```

**Audit:**  
Verify the operating system automatically terminates a user session after inactivity timeouts have expired.

```bash
grep -E "\bTMOUT=[0-9]+" /etc/bash.bashrc /etc/profile.d/*

```

**Fix:** 
> If "TMOUT" is not set, or if the value is "0" or is commented out,
create the file "/etc/profile.d/99-terminal_tmout.sh" file if it does not exist.
```bash
# Modify or append the following line in the "/etc/profile.d/99-terminal_tmout.sh " file:
TMOUT=600
# This will set a timeout value of 10 minutes for all future sessions.

# set the timeout for the current sessions
export TMOUT=600
```

**Audit:**  
Verify the "/etc/sudoers" file has no occurrences of "NOPASSWD" or "!authenticate" by running the following command:

```bash
sudo egrep -i '(nopasswd|!authenticate)' /etc/sudoers /etc/sudoers.d/*
```

**Fix:**
> Remove any occurrence of "NOPASSWD" or "!authenticate" found in "/etc/sudoers" file or files in the "/etc/sudoers.d" directory.

**Audit:**  
to be continued... 

```bash
to be continued... 
```

**Fix:**
```bash
to be continued... 
```

## Network security

**Audit:**  
to be continued... 

```bash
to be continued... 
```

**Fix:**
```bash
to be continued...
```

## Firewall configuration

**Audit:**  
to be continued... 

```bash
to be continued... 
```

**Fix:**
```bash
to be continued... 
```

## System updates and patches

**Audit:**  
to be continued... 

```bash
to be continued... 
```

**Fix:**
```bash
to be continued... 
```

## File system permissions

**Audit:**  
Verify the Ubuntu operating system defines default permissions for all authenticated users with the following command:

```bash
grep -i "umask" /etc/login.defs
```

**Fix:**
> If the value of "UMASK" is not set to "077", is commented out, or is missing completely
```bash
# Edit the "UMASK" parameter in the "/etc/login.defs" file to match the example below:
UMASK 077
```

**Audit:**  
to be continued... 

```bash
to be continued... 
```

**Fix:**
```bash
to be continued...
```

## Logging and monitoring

**Audit:**  
to be continued... 

```bash
to be continued... 
```

**Fix:**
```bash
to be continued... 
```

### Related

* [STIGS DOD Cyber Exchange Document Library Ubuntu Server](https://www.google.com/search?q=STIGS+DOD+Cyber+Exchange+Document+Library+Ubuntu+Server)
* [CIS Ubuntu Linux Benchmarks](https://www.google.com/search?q=CIS+Ubuntu+Linux+Benchmarks)